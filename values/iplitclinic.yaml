global:
  storageClass: bahmni-efs-sc
  nodeSelector:
    eks.amazonaws.com/nodegroup: prod
  TZ: "Asia/Kolkata"
  waf:
    enabled: true

metadata:
  labels:
    environment: iplitclinic
  ingress:
    PROXY_BODY_SIZE: "7m"
    ABDM_PROXY_BODY_SIZE: "30m"

openmrs:
  enabled: true
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/infoiplitin/openmrs
    tag: iplit-1.0.0-661-2
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 1
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app
                  operator: In
                  values:
                    - openmrs
            topologyKey: kubernetes.io/hostname
            namespaceSelector: {}

bahmni-web:
  enabled: true
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/infoiplitin/bahmni-iplit-web
    tag: 1.1.0-102

bahmni-lab:
  enabled: true
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/bahmni/bahmni-lab
    tag: 1.1.0-173

crater:
  enabled: true
  metadata:
    labels:
      environment: iplitclinic
  config:
    AUTO_INSTALL: "true"
    ADMIN_NAME: Super Man
    COMPANY_NAME: Bahmni
    COMPANY_SLUG: bahmni
    COUNTRY_ID: 101
  secrets:
    ADMIN_EMAIL: "superman@bahmni.org"
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    nginx:
      name: bahmnilite/bahmni/crater-nginx
      tag: 1.1.0-230
    php:
      name: bahmnilite/bahmni/crater-php
      tag: 1.1.0-108
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 1
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app
                  operator: In
                  values:
                    - "crater-php"
            topologyKey: kubernetes.io/hostname
            namespaceSelector: {}

reports:
  enabled: true
  metadata:
    labels:
      environment: iplitclinic
  config:
    OPENMRS_HOST: "openmrs"
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/bahmni/reports
    tag: 1.1.0-142
  resources: {}
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 1
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app
                  operator: In
                  values:
                    - reports
            topologyKey: kubernetes.io/hostname
            namespaceSelector: {}

hiu:
  enabled: true
  config:
    POSTGRES_HOST: "bahmni-iplitclinic-postgresql"
    RABBITMQ_HOST: "bahmni-iplitclinic-rabbitmq"
    HIU_ID: "IN2710025138"
    HIU_NAME: "IPLit Clinic"
    CONSENT_MANAGEMENT_SUFFIX: "@abdm"
    CONSENT_MANAGEMENT_URL: "https://live.abdm.gov.in/cm"
    GATEWAY_BASE_URL: "https://live.abdm.gov.in/gateway/v0.5"
    GATEWAY_JWK_URL: "https://live.abdm.gov.in/gateway/v0.5/certs"
    HFR_AFFINITY_DOMAINS: "facility.abdm.gov.in"
    IDENTITY_JWK_URL : "https://live.abdm.gov.in/auth/realms/consent-manager/protocol/openid-connect/certs"
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/bahmniindiadistro/hiu
    tag: 1.0.0-116
  resources: {}
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 1
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app
                  operator: In
                  values:
                    - hiu
            topologyKey: kubernetes.io/hostname
            namespaceSelector: {}

hiu-db:
  enabled: true
  config:
    JAVA_TOOL_OPTIONS: "-Djdbc.url=jdbc:postgresql://bahmni-iplitclinic-postgresql:5432/ -Djdbc.username=postgres -Djdbc.password=welcome -Djdbc.database=health_information_user"
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: hiu-db
    tag: 1.0.0-74

hiu-ui:
  enabled: true
  config:
    POSTGRES_HOST: bahmni-iplitclinic-postgresql
    RABBITMQ_HOST: bahmni-iplitclinic-rabbitmq
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/infoiplitin/hiu-ui
    tag: 1.0.0-10

hip:
  enabled: true
  config:
    CONNECTION_STRING: "Host=bahmni-iplitclinic-postgresql;Port=5432;Username=postgres;Password=welcome;Database=hipservice"
    RABBITMQ_HOST: "bahmni-iplitclinic-rabbitmq"
    BAHMNI_ID: "IN2710025138"
    BAHMNI_URL: http://openmrs:8080/openmrs
    ABHA_NUMBER_URL: "https://healthid.abdm.gov.in/api"
    ABHA_ADDRESS_URL: "https://phr.abdm.gov.in/api"
    GATEWAY_URL: "https://live.abdm.gov.in/gateway"
    GATEWAY_CMSUFFIX: "abdm"
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/infoiplitin/hip
    tag: 1.0.0-149
  resources: {}

otp-service:
  enabled: true
  config:
    CONNECTION_STRING: "Host=bahmni-iplitclinic-postgresql;Port=5432;Username=postgres;Password=welcome;Database=otpservice;"
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/infoiplitin/otp-service
    tag: 1.0.0-12

sms-service:
  enabled: true
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/bahmni/sms-service
    tag: 1.1.0-14

hip-atomfeed:
  enabled: true
  config:
    DATABASE_URL: "jdbc:postgresql://bahmni-iplitclinic-postgresql:5432/"
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/bahmniindiadistro/hip-atomfeed
    tag: 1.0.0-110
  resources: {}
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 1
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app
                  operator: In
                  values:
                    - "hip-atomfeed"
            topologyKey: kubernetes.io/hostname
            namespaceSelector: {}

postgresql:
  enabled: true
  volumePermissions:
    enabled: true
    image:
      registry: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
      repository: bitnami-shell
      tag: 11-debian-11-r50
  primary:
    persistence:
      subPath: iplitclinic
      storageClass: bahmni-efs-sc
      accessModes:
        - ReadWriteMany
      labels:
        app.kubernetes.io/instance: bahmni-iplitclinic
        app.kubernetes.io/name: postgresql
    nodeSelector:
      eks.amazonaws.com/nodegroup: prod
  image:
    registry: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    repository: postgresql
    tag: 14-debian-11

rabbitmq:
  enabled: true
  auth:
    securePassword: false
    erlangCookie: bahmni
  persistence:
    storageClass: bahmni-efs-sc
    accessModes:
      - ReadWriteMany
  nodeSelector:
    eks.amazonaws.com/nodegroup: prod
  image:
    repository: rabbitmq
    tag: alpine
  lifecycleHooks:
    postStart:
      exec:
        command:
          - /bin/bash
          - -ec
          - |
            echo "Default user setup...";
            rabbitmqctl wait -P 1 --timeout 30000;
            rabbitmqctl add_user "$RABBITMQ_USERNAME" "$RABBITMQ_PASSWORD" || true;
            rabbitmqctl set_user_tags "$RABBITMQ_USERNAME" administrator || true;
            rabbitmqctl set_permissions  "$RABBITMQ_USERNAME" "." "." ".*"  || true;
            echo "Default user setup is completed";
    preStop:
      exec:
        command:
          - /bin/bash
          - -ec
          - |
            if [[ -f /opt/bitnami/scripts/rabbitmq/nodeshutdown.sh ]]; then
                /opt/bitnami/scripts/rabbitmq/nodeshutdown.sh -t "120" -d "false"
            else
                rabbitmqctl stop_app
            fi

patient-documents:
  enabled: true
  metadata:
    labels:
      environment: iplitclinic
  config:
    OPENMRS_HOST: "openmrs"
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/bahmni/patient-documents
    tag: 1.1.0-32

appointments:
  enabled: true
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/bahmni/appointments
    tag: 1.1.0-119

crater-atomfeed:
  enabled: true
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/bahmni/crater-atomfeed
    tag: 1.1.0-125
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 1
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app
                  operator: In
                  values:
                    - "crater-atomfeed"
            topologyKey: kubernetes.io/hostname
            namespaceSelector: {}

implementer-interface:
  enabled: true
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/bahmni/implementer-interface
    tag: 1.1.0-74

clinic-config:
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/infoiplitin/clinic-config-indiadistro
    tag: 1.1.0-42

abha-verification:
  enabled: true
  metadata:
    labels:
      environment: iplitclinic
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/infoiplitin/abha-verification
    tag: 1.0.0-5

bahmni-metabase:
  enabled: true
  config:
    MB_DB_TYPE: postgres
    MB_DB_DBNAME: 'metabase'
    MB_DB_PORT:  5432
    MART_DB_NAME: martdb
  secrets:
    MB_ADMIN_FIRST_NAME: 'Admin'
    MB_DB_HOST: 'bahmni-iplitclinic-postgresql'
    MART_DB_HOST: 'bahmni-iplitclinic-postgresql'
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/bahmni/bahmni-metabase
    tag: 1.1.0-38
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 1
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app
                  operator: In
                  values:
                    - "bahmni-metabase"
            topologyKey: kubernetes.io/hostname
            namespaceSelector: {}

bahmni-mart:
  enabled: true
  config:
    MART_DB_NAME: martdb
  secrets:
    MART_DB_HOST: "bahmni-iplitclinic-postgresql"
  image:
    repository: 600047163007.dkr.ecr.ap-south-1.amazonaws.com
    name: bahmnilite/bahmni/bahmni-mart
    tag: 1.1.0-63
